---

- name: touch counter_collector success
  file:
    path: "{{ ansible_flag }}/{{ flag_success }}"
    state: touch
  when: check_result is success and ansible_play_hosts == ansible_play_hosts_all
  delegate_to: 127.0.0.1
  run_once: true

- name: touch counter_collector failed
  file:
    path: "{{ ansible_flag }}/{{ flag_retry }}"
    state: touch
  when: "check_result is failed and \
         curr_time_hhmm.stdout.strip()|int < counter_fetch_end_time|int or \
         ansible_play_hosts != ansible_play_hosts_all"
  delegate_to: 127.0.0.1
  run_once: true

- name: touch counter_collector timeout
  file:
    path: "{{ ansible_flag }}/{{ flag_timeout }}"
    state: touch
  when: "check_result is failed and \
         curr_time_hhmm.stdout.strip()|int >= counter_fetch_end_time|int"
  delegate_to: 127.0.0.1
  run_once: true
